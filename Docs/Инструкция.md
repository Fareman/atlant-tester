# Описание этапов сервиса

## Шаг 1. Получение тестового задания из github-репозиторий

В запущенный сервис подается ссылка на github-репозиторий. Она должна соответствовать следующему шаблону, иначе программа выдаст соответствующую ошибку.

```
https://github.com/{Владелец репозитория}/{Название репозитория}
```

По данной ссылке скачивается байт-массив, содержащий проект, из которого создается архив, расположенный во временной директории. Там же архив распаковывается, и в последующие стадии передается путь к проекту. Путь к корневой папке выглядит следующим образом:

```
%TEMP%/Repo_{Guid.NewGuid()}/{Владелец}-{Название репозитория}-{Первые 7 символов id коммита}
```

## Шаг 2. Этап создания сборки проекта

По относительному пути получается расположение файла решения и проверяется его наличие в заданной директории. Далее в директории, где находится решение, запускается команда

```
dotnet build {путь к решению}
```

Для сборки проекта. В зависимости от результата сборки метод возвращает соответствующую запись со статусом этапа и описанием. Если этап сборки завершился неудачно, то дальнейшие стадии пропускаются и выдается отчет с причиной.

## Шаг 3. Этап проведения Resharper-проверки

По относительному пути получается расположение файла решения и проверяется его наличие в заданной директории. Далее в директории, где находится решение, запускается команда

```
jb inspectcode {путь к решению} --output={название отчета} --profile={путь к конфигу проверки}
```

Далее полученный xml отчет решарпера проверяется на наличие узлов с ошибками и метод с этапом возвращает соответствующую запись в отчете в папку тестируемого проекта.

## Шаг 4. Этап сборки композиции и проведение тестов postman

В начале этапа проверяется наличие файлов docker-compose у сервиса и тестируемого проекта с предусмотренным выведением ошибки в случае отсутствия одного из файлов. Далее запускается команда:

```
docker-compose -f {testProjectComposeFile} -f {serviceComposeFile} up --abort-on-container-exit
```

Она запускает композицию, в которой на тестовый проект посылаются запросы из коллекции в postman. В результате при наличии ошибок сборки контейнеров выводится статус операции и лог композиции, а иначе полный отчет сгенерированный postman в одноименную папку сервиса.

После работы с контейнерами удаляется композиция и папка, содержащая проект.

## Шаг 5. Создание итогового отчета

Из всех предыдущих этапов берутся записи и соединяются в одну большую мега-запись. В результате ответным сообщением сервис отправляет json-объект, содержащий заметки о всех этапах тестирования.
